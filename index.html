<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <style>
    .sourceImg {
      border: 1px solid red;
      float: left;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    .hidden-box {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(00, 00, 00, .7);
      display: none;
    }
    .previewContainer {
      width: 800px;
      height: 600px;
      border: 1px solid black;
      border-radius: 3px;
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      margin: auto;
      background: #fff;
    }
    #myCanvas {
      border-bottom: 1px solid #ccc;
      margin: 0 auto;
    }
    .img-box {
      float: left;
      width: 200px;
      height: 250px;
      border: 1px solid green;
      margin: 10px;
    }
    .img-box img{
      width: 200px;
      height: 200px;
      vertical-align: top;
    }
  </style>
</head>
<body>
  <div class="sourceImg">
    <div class="img-box">
      <img src="img/shiyitu1.jpg" alt="示意图一" id="img_001">
      <button class="preview">预览</button>
    </div>
    <div class="img-box">
      <img src="img/shiyitu1.jpg" alt="示意图一" id="img_002">
      <button class="preview">预览</button>
    </div>
    <div class="img-box">
      <img src="img/shiyitu1.jpg" alt="示意图一" id="img_003">
      <button class="preview">预览</button>
    </div>
    <div class="img-box">
      <img src="img/shiyitu1.jpg" alt="示意图一" id="img_004">
      <button class="preview">预览</button>
    </div>
    <div class="img-box">
      <img src="img/shiyitu1.jpg" alt="示意图一" id="img_005">
      <button class="preview">预览</button>
    </div>
  </div>
  <div class="hidden-box">
    <div class="previewContainer">
      <canvas id="myCanvas" width="800" height="500">
        <p>该浏览器不支持</p>
      </canvas>
      <div class="contron-btns">
        <button class="markImgByRect">矩形标记</button>
        <button class="markImgByEllipse">椭圆标记</button>
        <button class="goback">撤销上一步</button>
        <button class="clearAllMarks">清空所有标记</button>
        <button class="close">关闭</button>
        <button class="saveImg">保存</button>
      </div>
    </div>
  </div>
  <script src="js/jquery-3.2.1.min.js"></script>
  <script src="js/jcanvas.min.js"></script>
  <script src="js/dealImage.js"></script>
  <script>
    var canvas = $('canvas')
    var id = '#img_001'
    var infos = {}
    infos.imageInfo = {
      layer: true,
      name: 'background',
      source: $(id)[0],
      x: 50, y: 50,
      width: 750,
      height: 400,
      fromCenter: false
    }
    infos.markInfos = [{ "type": "rectangle", "strokeStyle": "red", "strokeWidth": 1, "name": "ln_0", "fromCenter": false, "x": 368.59375, "y": 214, "width": 65, "height": 84 }, { "type": "rectangle", "strokeStyle": "red", "strokeWidth": 1, "name": "ln_1", "fromCenter": false, "x": 512.59375, "y": 300, "width": 93, "height": 88 }, { "type": "rectangle", "strokeStyle": "red", "strokeWidth": 1, "name": "ln_2", "fromCenter": false, "x": 384.59375, "y": 378, "width": 61, "height": 47 }, { "type": "ellipse", "strokeStyle": "red", "strokeWidth": 1, "name": "ln_3", "fromCenter": false, "x": 286.59375, "y": 173, "width": 400, "height": 299 }]

    // function getMarkInfos() {
    //   $.post("test.php", { "func": "getNameAndTime" },
    //     function (data) {
    //       initImage(markInfos, id)
    //     }, "json");
    // }
   
    // function submitMarkInfo () {
    //   $.post("test.php", { 'choices[]': ["Jon", "Susan"] });
    // }

    /**下面给各种按钮绑定相应事件*/
    $('.markImgByEllipse').on('click', function () {
     canvas.off('mousedown')
     canvas.on('mousedown', DrawImageUtil.drawMark)
      DrawImageUtil.setMarkType('ellipse')
    })
    $('.markImgByRect').on('click', function () {
     canvas.off('mousedown')
     canvas.on('mousedown', DrawImageUtil.drawMark)
      DrawImageUtil.setMarkType('rectangle')
    })

    $('.clearAllMarks').on('click', function () {
      DrawImageUtil.clearAllMarks()
    })

    $('.goback').on('click', function () {
      DrawImageUtil.turnToLast()
    })

    $('.preview').on('click', function () {
      $('.hidden-box').fadeIn()
      id = $(this).siblings('img').attr('id')
      DrawImageUtil.initImage(infos, canvas, id)
      canvas.off()
      $('markImgByEllipse').off()
      $('markImgByRect').off()
    })
    $('.close').on('click', function () {
      DrawImageUtil.clearAllMarks()
      canvas.off()
      $('markImgByEllipse').off()
      $('markImgByRect').off()
      $('.hidden-box').fadeOut()
    })
    // 保存图片
    $('.saveImg').on('click', function () {
      var newMarks = DrawImageUtil.getMarks()
      console.log(JSON.parse(JSON.stringify(markInfos)).concat(newMarks))
      submitMarkInfo(markList)
    })
    /**上面给各种按钮绑定相应事件*/
    
  </script>
</body>
</html>